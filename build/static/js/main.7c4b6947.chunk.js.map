{"version":3,"sources":["App.js","index.js","app.module.scss"],"names":["currentMode","isMousePressed","currentColor","currentWidth","group","modes","pan","drawing","clearCanvas","canvas","getObjects","forEach","item","backgroundImage","remove","groupObjects","shouldGroup","objects","value","fabric","Group","add","destroy","oldGroup","requestRenderAll","uploadImage","e","reader","FileReader","file","target","files","addEventListener","Image","fromURL","result","img","readAsDataURL","App","useState","setCanvas","useEffect","Canvas","height","width","selection","on","event","setCursor","isDrawingMode","freeDrawingBrush","color","addCanvasEventListeners","className","styles","app","onClick","rect","Rect","top","left","fill","objectCaching","data","console","log","createRect","circle","Circle","radius","cornerSize","createCircle","triangle","Triangle","createTriangle","url","createBackgroundImage","mode","type","onChange","min","max","JSON","stringify","toJSON","canvasToJson","parse","loadFromJSON","canvasFromJson","accept","id","ReactDOM","render","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.7c4b6947.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { fabric } from \"fabric\";\n\nimport styles from \"./app.module.scss\";\n\nlet isMousePressed = false;\nlet currentMode;\nlet currentColor = \"#000000\";\nlet currentWidth = 1;\nlet group = {};\n\nconst modes = {\n  pan: \"pan\",\n  drawing: \"drawing\",\n};\n\nconst initCanvas = () =>\n  new fabric.Canvas(\"canvas\", {\n    height: 500,\n    width: 500,\n    selection: false,\n  });\n\nconst createBackgroundImage = (url, canvas) => {\n  fabric.Image.fromURL(\n    url,\n    (img) => {\n      // img.scale(0.3);\n      canvas.add(img);\n    },\n    {\n      top: 0,\n      left: 0,\n      cornerSize: 7,\n    }\n  );\n  canvas.requestRenderAll();\n};\n\nfunction createRect(canvas) {\n  const rect = new fabric.Rect({\n    top: 100,\n    left: 100,\n    width: 60,\n    height: 70,\n    fill: currentColor,\n    objectCaching: false,\n  });\n\n  rect.on(\"selected\", (data) => {\n    console.log(\"選中了\", data);\n  });\n\n  canvas.add(rect);\n  canvas.requestRenderAll();\n}\n\nfunction createCircle(canvas) {\n  const circle = new fabric.Circle({\n    top: 200,\n    left: 200,\n    radius: 50,\n    fill: currentColor,\n    cornerSize: 7,\n    objectCaching: false,\n  });\n\n  canvas.add(circle);\n  canvas.requestRenderAll();\n}\n\nfunction createTriangle(canvas) {\n  const triangle = new fabric.Triangle({\n    top: 400,\n    left: 300,\n    width: 50,\n    height: 70,\n    fill: currentColor,\n    cornerSize: 7,\n    objectCaching: false,\n  });\n\n  canvas.add(triangle);\n  canvas.requestRenderAll();\n}\n\nconst addCanvasEventListeners = (canvas) => {\n  canvas.on(\"mouse:down\", (event) => {\n    isMousePressed = true;\n  });\n\n  canvas.on(\"mouse:move\", (event) => {\n    if (currentMode === modes.drawing) {\n      canvas.setCursor(\"crosshair\");\n      canvas.requestRenderAll();\n    }\n\n    if (isMousePressed && currentMode === modes.pan) {\n      canvas.setCursor(\"grab\");\n      canvas.requestRenderAll();\n    } else if (isMousePressed && currentMode === modes.drawing) {\n      canvas.isDrawingMode = true;\n      canvas.freeDrawingBrush.color = currentColor;\n      canvas.freeDrawingBrush.width = currentWidth;\n\n      canvas.requestRenderAll();\n    }\n  });\n\n  canvas.on(\"mouse:up\", (event) => {\n    isMousePressed = false;\n    // canvas.setCursor(\"default\");\n    // canvas.requestRenderAll();\n  });\n};\n\nconst toggleMode = (mode) => {\n  if (currentMode === modes[mode]) {\n    currentMode = \"\";\n  } else {\n    currentMode = modes[mode];\n  }\n};\n\nconst clearCanvas = (canvas) => {\n  canvas.getObjects().forEach((item) => {\n    if (item !== canvas.backgroundImage) {\n      canvas.remove(item);\n    }\n  });\n};\n\nconst canvasFromJson = (canvas) => {\n  const data = JSON.parse(\n    '{\"version\":\"4.3.1\",\"objects\":[{\"type\":\"circle\",\"version\":\"4.3.1\",\"originX\":\"left\",\"originY\":\"top\",\"left\":100,\"top\":100,\"width\":40,\"height\":40,\"fill\":\"rgba(255, 255, 255, 0.0)\",\"stroke\":\"#000000\",\"strokeWidth\":1,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"radius\":20,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"text\",\"version\":\"4.3.1\",\"originX\":\"left\",\"originY\":\"top\",\"left\":253,\"top\":102,\"width\":95.55,\"height\":18.08,\"fill\":\"#000000\",\"stroke\":null,\"strokeWidth\":1,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":2.43,\"scaleY\":2.43,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"text\":\"Some text\",\"fontSize\":16,\"fontWeight\":\"normal\",\"fontFamily\":\"Arial\",\"fontStyle\":\"normal\",\"lineHeight\":1.16,\"underline\":false,\"overline\":false,\"linethrough\":false,\"textAlign\":\"left\",\"textBackgroundColor\":\"\",\"charSpacing\":0,\"minWidth\":20,\"splitByGrapheme\":false,\"styles\":{}},{\"type\":\"rect\",\"version\":\"4.3.1\",\"originX\":\"left\",\"originY\":\"top\",\"left\":109,\"top\":212,\"width\":40,\"height\":40,\"fill\":\"rgba(255, 255, 255, 0.0)\",\"stroke\":\"#000000\",\"strokeWidth\":1,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"rx\":0,\"ry\":0},{\"type\":\"image\",\"version\":\"4.3.1\",\"originX\":\"left\",\"originY\":\"top\",\"left\":499,\"top\":86,\"width\":1200,\"height\":900,\"fill\":\"rgb(0,0,0)\",\"stroke\":null,\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":0.2,\"scaleY\":0.2,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"cropX\":0,\"cropY\":0,\"src\":\"https://miro.medium.com/max/1200/1*mk1-6aYaf_Bes1E3Imhc0A.jpeg\",\"crossOrigin\":null,\"filters\":[]},{\"type\":\"polyline\",\"version\":\"4.3.1\",\"originX\":\"left\",\"originY\":\"top\",\"left\":483.78,\"top\":339.22,\"width\":50.88,\"height\":50.88,\"fill\":\"white\",\"stroke\":\"black\",\"strokeWidth\":2,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":262.52,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"points\":[{\"x\":100,\"y\":100},{\"x\":99.11611652351681,\"y\":100.88388347648318},{\"x\":145.58058261758407,\"y\":147.34834957055045},{\"x\":142.92893218813452,\"y\":150},{\"x\":150,\"y\":150},{\"x\":150,\"y\":142.92893218813452},{\"x\":147.34834957055045,\"y\":145.58058261758407},{\"x\":100.88388347648318,\"y\":99.11611652351681},{\"x\":100,\"y\":100}]},{\"type\":\"image\",\"version\":\"4.3.1\",\"originX\":\"left\",\"originY\":\"top\",\"left\":197,\"top\":132,\"width\":1200,\"height\":900,\"fill\":\"rgb(0,0,0)\",\"stroke\":null,\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":0.2,\"scaleY\":0.2,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"cropX\":0,\"cropY\":0,\"src\":\"https://miro.medium.com/max/1200/1*mk1-6aYaf_Bes1E3Imhc0A.jpeg\",\"crossOrigin\":null,\"filters\":[]}]}'\n  );\n  canvas.loadFromJSON(data);\n  canvas.requestRenderAll();\n};\n\nconst canvasToJson = (canvas) => {\n  console.log(JSON.stringify(canvas.toJSON()));\n};\n\nconst groupObjects = (canvas, group, shouldGroup) => {\n  if (shouldGroup) {\n    const objects = canvas.getObjects();\n    group.value = new fabric.Group(objects);\n    clearCanvas(canvas); // 先清除先前的，否則會重複出現兩組\n\n    canvas.add(group.value);\n  } else {\n    if (group.value) {\n      group.value.destroy();\n      const oldGroup = group.value.getObjects();\n      canvas.remove(group.value);\n      canvas.add(...oldGroup);\n      group.value = null;\n      canvas.requestRenderAll();\n    }\n  }\n};\n\nconst uploadImage = (canvas) => {\n  return (e) => {\n    const reader = new FileReader();\n    const file = e.target.files[0];\n\n    reader.addEventListener(\"load\", () => {\n      fabric.Image.fromURL(reader.result, (img) => {\n        canvas.add(img);\n      });\n    });\n\n    reader.readAsDataURL(file);\n  };\n};\n\nconst App = () => {\n  const [canvas, setCanvas] = useState(\"\");\n  useEffect(() => {\n    setCanvas(initCanvas());\n  }, []);\n\n  useEffect(() => {\n    if (canvas) {\n      addCanvasEventListeners(canvas);\n    }\n  }, [canvas]);\n\n  return (\n    <div className={styles.app}>\n      <button onClick={() => createRect(canvas)}>rectangle</button>\n      <button onClick={() => createCircle(canvas)}>circle</button>\n      <button onClick={() => createTriangle(canvas)}>triangle</button>\n      <button\n        onClick={() =>\n          createBackgroundImage(\"https://i.imgur.com/MFdYlTH.png\", canvas)\n        }\n      >\n        image\n      </button>\n      <button onClick={() => toggleMode(modes.drawing)}>pencil</button>\n      <input type=\"color\" onChange={(e) => (currentColor = e.target.value)} />\n      <input\n        type=\"range\"\n        min={1}\n        max={20}\n        onChange={(e) => (currentWidth = e.target.value)}\n      />\n      <button onClick={() => clearCanvas(canvas)}>clear all</button>\n      <button onClick={() => groupObjects(canvas, group, true)}>\n        group all objects\n      </button>\n      <button onClick={() => groupObjects(canvas, group, false)}>\n        ungroup\n      </button>\n\n      <button onClick={() => canvasToJson(canvas)}>toJson</button>\n      <button onClick={() => canvasFromJson(canvas)}>fromJson</button>\n      <input type=\"file\" accept=\"image/*\" onChange={uploadImage(canvas)} />\n      <canvas id=\"canvas\"></canvas>\n    </div>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\nimport \"./index.scss\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"app_app__3mk8F\",\"canvas\":\"app_canvas__1LfB-\"};"],"sourceRoot":""}