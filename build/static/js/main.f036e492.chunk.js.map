{"version":3,"sources":["App.js","index.js","app.module.scss"],"names":["currentMode","isMousePressed","currentColor","currentWidth","group","clearCanvas","canvas","getObjects","forEach","item","backgroundImage","remove","groupObjects","shouldGroup","objects","value","fabric","Group","add","destroy","oldGroup","requestRenderAll","uploadImage","e","reader","FileReader","file","target","files","addEventListener","Image","fromURL","result","img","readAsDataURL","App","useState","setCanvas","useEffect","Canvas","height","width","selection","on","event","setCursor","isDrawingMode","freeDrawingBrush","color","addCanvasEventListeners","className","styles","app","onClick","rect","Rect","top","left","fill","objectCaching","data","console","log","createRect","circle","Circle","radius","cornerSize","createCircle","triangle","Triangle","createTriangle","url","createBackgroundImage","type","onChange","min","max","accept","id","ReactDOM","render","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.f036e492.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { fabric } from \"fabric\";\n\nimport styles from \"./app.module.scss\";\n\nlet isMousePressed = false;\nlet currentMode;\nlet currentColor = \"#000000\";\nlet currentWidth = 1;\nlet group = {};\n\nconst initCanvas = () =>\n  new fabric.Canvas(\"canvas\", {\n    height: 500,\n    width: 500,\n    selection: false,\n  });\n\nconst createBackgroundImage = (url, canvas) => {\n  fabric.Image.fromURL(\n    url,\n    (img) => {\n      // img.scale(0.3);\n      canvas.add(img);\n    },\n    {\n      top: 0,\n      left: 0,\n      cornerSize: 7,\n    }\n  );\n  canvas.requestRenderAll();\n};\n\nfunction createRect(canvas) {\n  const rect = new fabric.Rect({\n    top: 100,\n    left: 100,\n    width: 60,\n    height: 70,\n    fill: currentColor,\n    objectCaching: false,\n  });\n\n  rect.on(\"selected\", (data) => {\n    console.log(\"選中了\", data);\n  });\n\n  canvas.add(rect);\n  canvas.requestRenderAll();\n}\n\nfunction createCircle(canvas) {\n  const circle = new fabric.Circle({\n    top: 200,\n    left: 200,\n    radius: 50,\n    fill: currentColor,\n    cornerSize: 7,\n    objectCaching: false,\n  });\n\n  canvas.add(circle);\n  canvas.requestRenderAll();\n}\n\nfunction createTriangle(canvas) {\n  const triangle = new fabric.Triangle({\n    top: 400,\n    left: 300,\n    width: 50,\n    height: 70,\n    fill: currentColor,\n    cornerSize: 7,\n    objectCaching: false,\n  });\n\n  canvas.add(triangle);\n  canvas.requestRenderAll();\n}\n\nconst addCanvasEventListeners = (canvas) => {\n  canvas.on(\"mouse:down\", (event) => {\n    isMousePressed = true;\n\n    if (currentMode === \"pencil\") {\n      canvas.setCursor(\"crosshair\");\n      canvas.requestRenderAll();\n    }\n  });\n\n  canvas.on(\"mouse:move\", (event) => {\n    if (isMousePressed && currentMode === \"pencil\") {\n      canvas.isDrawingMode = true;\n      canvas.freeDrawingBrush.color = currentColor;\n      canvas.freeDrawingBrush.width = currentWidth;\n\n      canvas.requestRenderAll();\n    }\n  });\n\n  canvas.on(\"mouse:up\", (event) => {\n    isMousePressed = false;\n    canvas.setCursor(\"default\");\n    canvas.requestRenderAll();\n  });\n};\n\nconst toggleMode = (mode) => {\n  currentMode = mode;\n};\n\nconst clearCanvas = (canvas) => {\n  canvas.getObjects().forEach((item) => {\n    if (item !== canvas.backgroundImage) {\n      canvas.remove(item);\n    }\n  });\n};\n\nconst groupObjects = (canvas, group, shouldGroup) => {\n  if (shouldGroup) {\n    const objects = canvas.getObjects();\n    group.value = new fabric.Group(objects);\n    clearCanvas(canvas); // 先清除先前的，否則會重複出現兩組\n\n    canvas.add(group.value);\n  } else {\n    if (group.value) {\n      group.value.destroy();\n      const oldGroup = group.value.getObjects();\n      canvas.remove(group.value);\n      canvas.add(...oldGroup);\n      group.value = null;\n      canvas.requestRenderAll();\n    }\n  }\n};\n\nconst uploadImage = (canvas) => {\n  return (e) => {\n    const reader = new FileReader();\n    const file = e.target.files[0];\n\n    reader.addEventListener(\"load\", () => {\n      fabric.Image.fromURL(reader.result, (img) => {\n        canvas.add(img);\n      });\n    });\n\n    reader.readAsDataURL(file);\n  };\n};\n\nconst App = () => {\n  const [canvas, setCanvas] = useState(\"\");\n  useEffect(() => {\n    setCanvas(initCanvas());\n  }, []);\n\n  useEffect(() => {\n    if (canvas) {\n      addCanvasEventListeners(canvas);\n    }\n  }, [canvas]);\n\n  return (\n    <div className={styles.app}>\n      <button onClick={() => createRect(canvas)}>rectangle</button>\n      <button onClick={() => createCircle(canvas)}>circle</button>\n      <button onClick={() => createTriangle(canvas)}>triangle</button>\n      <button\n        onClick={() =>\n          createBackgroundImage(\"https://i.imgur.com/MFdYlTH.png\", canvas)\n        }\n      >\n        image\n      </button>\n      <button onClick={() => toggleMode(\"pencil\")}>pencil</button>\n      <input type=\"color\" onChange={(e) => (currentColor = e.target.value)} />\n      <input\n        type=\"range\"\n        min={1}\n        max={20}\n        onChange={(e) => (currentWidth = e.target.value)}\n      />\n      <button onClick={() => clearCanvas(canvas)}>clear all</button>\n      <button onClick={() => groupObjects(canvas, group, true)}>\n        group all objects\n      </button>\n      <button onClick={() => groupObjects(canvas, group, false)}>\n        ungroup\n      </button>\n      <input type=\"file\" accept=\"image/*\" onChange={uploadImage(canvas)} />\n      <canvas id=\"canvas\"></canvas>\n    </div>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\nimport \"./index.scss\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"app_app__3mk8F\",\"canvas\":\"app_canvas__1LfB-\"};"],"sourceRoot":""}